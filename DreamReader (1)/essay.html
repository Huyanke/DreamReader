<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<link rel="stylesheet" href="css/reset.css" />
		<link rel="stylesheet" href="css/DreamReader.css" />
		<script src="js/jquery-1.11.0.js"></script>

		<link type="text/css" rel="stylesheet" href="css/index.css"/>
        <link type="text/css" rel="stylesheet" href="css/page.css">
        <script src="js/EssayPage.js"></script>
		<title>新闻超秘</title>
	</head>
	<body>
	   <div class="mask"></div>
       <div class="DreamReader">
          <header class="nav">
         	<div class="logo">
               <img src="img/logo.png" alt="" />
                                新闻超秘管理系统
         	</div>
         	<ul class="nav_list">
               <li><a href="publish.html" target="_blank">发文</a></li>
               <li><a href="ready.html" target="_blank">备选池</a></li>
               <li><a class="active" href="essay.html" target="_blank">文章池</a></li>
         	</ul>
         	<div class="account">
         	     欢迎你
               <span>admin</span>
               <a href="#">退出</a>
         	</div>
          </header>
          <aside class="sort">
         	<p>文章管理</p>
            <ul class="sort_list">
           	  <li class="sort_active">全部文章</li>
            </ul>
         </aside>
        <div class="content_main">
         <section class="seek">
            <input type="search" placeholder="关键词" class="search"/>
            <input type="submit" value="搜 索" class="search_btn"/>
         </section>
         <section class="seek">
         	<div class="operate">
             <span><a href="publish.html" target="_blank">添加文章</a></span>
             <span class="remove">删除</span>
            </div>
            <ul class="main_nav_title essay_nav" style="background-color: #fff;">
            	<li><input type="checkbox" class="checkAll"/>缩略图</li>
            	<li>标题</li>
            	<li>来源</li>
            	<li>生成时间</li>
            	<li>概要</li>
            	<li>正文</li>
            	<li>发布时间</li>
            	<li>APP</li>
            	<li>操作</li>
            </ul>
         </section>
         <div class="main">
          <section class="search_info">
	        <div class="main_info"></div>
	      </section>
          <section class="content all_content" style="display: block;">
            <div class="main_info"></div>
          </section>
	     </div>
         <div class="Allclip"></div>
         </div>
         <section class="alter_info">
         <div class="alter_mask"></div>
           <div class="alter_head">
              <span class="alter_title">概要修改</span>
              <span class="alert_off">&times;</span>
           </div>
           <div class="alert_main">
               <label class="alert_list">
               	 <span  class="alert_topic">文章标题</span>
               	 <input type="text" class="inp tet title" onkeyup="words_deal()">
               	 <span class="num_hint"><span class="textCount">0</span>/23</span>
               	 <p class="hint_p"><span class="alert_hint">内容不能为空</span></p>
               </label>
               <label class="alert_list">
               	 <p class="check"><span  class="alert_topic">文章分类</span></p>
                  <div class="table">
                   <table class="alert_table table_odd">
               	 	  <tr>
						<td>
						</td>
						<td></td>
						<td></td>
						<td></td>
						<td></td>
					  </tr>
					  <tr>
					    <td></td>
					    <td></td>
					    <td></td>
					    <td></td>
					    <td></td>
					  </tr>
					  <tr>
					    <td></td>
					    <td></td>
					    <td></td>
					    <td></td>
					    <td></td>
					  </tr>
               	 	</table>
               	  </div>
               	   <p class="hint_p"><span class="alert_hint">请选择分类</span></p>
               </label>
               <label class="alert_list clear">
                 <span  class="alert_topic">文章来源</span>
               	 <input type="text" class="inp tet source" onkeyup="words_deal()">
               	 <span class="num_hint"><span class="textCount">0</span>/23</span>
               	  <p class="hint_p"><span class="alert_hint">内容不能为空</span></p>
               </label>
               <label class="alert_list clear">
               	 <p class="check"><span  class="alert_topic">文章摘要</span></p>
               	 <textarea class="alert_textarea tet summary" onkeyup="words_deal()"></textarea>
               	 <p class="hint_p"><span class="alert_hint">内容不能为空</span></p>
               	 <span class="num_hint"><span class="textCount">0</span>/450</span>
               	 <p class="section_button clear"></p>
               </label>
               <label class="alert_list clear">
               	 <span  class="alert_topic">摘要语音</span>
               	 <span class="mp3_s">
               	 	 <img src="img/no_mp3.png" alt="" class="no_music music_pic"/>
               	 	 <span class="music_begin" >
               	 	 	<img src="img/yes_mp3.png" alt="" class="music_pic"/>
               	 	 	<img src="img/play.png" alt="" class="music_btn playimg"/>
               	 	 	<div class="play_eff">
				          <img src="img/play1.png" alt="" />
				          <img src="img/play2.png" alt="" />
				          <img src="img/play3.png" alt="" />
				        </div>
               	 	 	<audio class="audio" src=""></audio>
               	 	 </span>
               	 </span>
               	 <p class="section_button clear">
               	 	<span class="gain_voice create_btn">生成语音</span>
               	 </p>
               </label>
               <div class="alert_btn">
               	 <span class="issue_btn">发布</span>
               	 <span class="save_btn">保存</span>
               </div>
               <div class="issue_win">
                  <div class="issue_title"><span class="issue_off">&times;</span></div>
                  <h4>是否保存修改内容？</h4>
                  <p class="save_win">
                  	<span class="save_win_save">保存</span>
                  	<span class="save_win_nosave">不保存</span>
                  	<span class="call_off">取消</span>
                  </p>
               </div>

           </div>
         </section>

       </div>
        <div class="state_info"></div>
	</body>
</html>
<script type="text/javascript">
    clipInit(1);

    function Data(data) {
    	$(".all_content .main_info").empty();
    	 var total = data.data.total;
          $(".checkAll").val(total)
	 for(var i=0;i < 20;i++){
          var essay_main_list = '';
          essay_main_list = '<ul class="main_nav_list essay_nav_list"><li><input type="checkbox"  name="list" value='+data.data.articlelist[i].id+' class="son"><input type="hidden" value='+ data.data.articlelist[i].channellist+' name="channellist"><input type="hidden" value='+ data.data.articlelist[i].summary+' name="summary"><input type="hidden" value='+ data.data.articlelist[i].voiceurl+' name="voiceurl"><img src='+data.data.articlelist[i].picurl+' alt="" /></li><li class="text_info">'+data.data.articlelist[i].title+'</li><li>'+data.data.articlelist[i].source+'</li><li>'+data.data.articlelist[i].create_time+'</li><li class="out_modify">修改</li><li class="text_modify"><a href="publish.html?id='+data.data.articlelist[i].id+'" target="_blank">修改</a></li><li class="publish_time">'+data.data.articlelist[i].publish_time+'</li><li class="issue">发布</li><li class="focused" >'+data.data.articlelist[i].focused+'置顶</li><p class="show_text">'+data.data.articlelist[i].summary+'</p></ul>';
          $(".all_content .main_info").append(essay_main_list);
          state(data,i)

	    }
	  }

    /*数据状态*/
    function state(data,i) {
    	/*发布APP状态*/
        var published = data.data.articlelist[i].published;

          switch(published) {
			case '1':
			   $(".issue").eq(i).text("发布成功")
		    break;
		    case '0':
			   $(".issue").eq(i).text("发布");
			   $(".issue").eq(i).addClass("issue_button");
			   $(".focused").eq(i).removeClass("focused_button");
			   $(".focused").eq(i).addClass("nofocused");
		    break;
		  }
        var voiceurl = data.data.articlelist[i].voiceurl;


        /*未生成语音*/
          switch(voiceurl) {
			case null:
			   $(".issue").eq(i).text("发布")
	           $(".issue").eq(i).addClass("noissue");
	           $(".issue").eq(i).removeClass("issue_button");
		    break;
		  }


        /*发布时间*/
        var publish_time = data.data.articlelist[i].publish_time;
          switch(publish_time) {
			case null:
			   $(".publish_time").eq(i).text("———")
		    break;
		  }
        /*置顶*/
        var focused = data.data.articlelist[i].focused;
          switch(focused) {
			case '1':
			   $(".focused").eq(i).text("已置顶")
		    break;
		    case '0':
		       $(".focused").eq(i).text("置顶")
		       $(".focused").eq(i).addClass("focused_button");

		  }
    }

$(window).load(function(){
   setTimeout(function() {
	pageCon = Math.ceil($(".checkAll").val() / 20 );
	clipInit(pageCon);
},10)

})
</script>
<script src="js/Confine.js"></script>
<script type="text/javascript">

   $(function(){
   	 //全选删除
   	$(".checkAll").click(function () {
        if(this.checked ==  true){
           $("input[name='list']").prop('checked', true);
        }else{
           $("input[name='list']").prop('checked', false);
        }
    })

     $(".main_info").on("click", ".son", function() {
        var len = $(".son").length;

        var checkedLen  = $("input[type='checkbox'][name='list']:checked").length;
        if(len  ==  checkedLen){
            $('.checkAll').prop('checked', true);
        }else{
            $('.checkAll').prop('checked', false);
        }
    })

    $(".remove").bind("click",function() {
      var new_channelid = new Array();
		$(".main_info input[name=list]").each(function() {
		  if ($(this).is(":checked")) {
		    new_channelid.push($(this).val());
		    $(this).parent().parent().remove();
		  }
		});

		  var JsonData = { 
			"idlist": new_channelid
		  }

		$.ajax({
	    	type: 'post',
//	    	url: "http://dreamwriter.webdev.com/app/deletearticle",
	        url: "http://localhost:3334/10deletearticel",
	        dataType:'json',
	        data: JSON.stringify(JsonData),
	        success: function (data) {
	           console.log(data)

           	  if(data.response.code == 0) {
           	  	    var tet = "删除成功 ！";
                    State(tet);
				//	window.location.reload();
				}else {
				    var tet = "删除失败 ！";
                    State(tet);
			  }
	        },
	        error: function (msg) {
	           console.log(msg);
	        }
	    });

    })

   	/*文章池搜索*/

    $(".search").keypress(function (e) {
	 var key = e.which;
	 if (key == 13) {
	   search();
	  }
	});

    $(".search_btn").bind("click", function() {
       search();
    });

    function search() {
    	console.log(1)
      var search_text = $(".search").val();
      if(search_text != "") {
         $(".content").hide();
         $(".search_info .main_info").empty();
          var JsonData = { 
			"keyword": search_text,
	        "articletype":"1" 
		  }
	      $.ajax({
	    	type: 'post',
//	    	url: "http://dreamwriter.webdev.com/app/search",
	        url: "http://localhost:3334/9search",
	        dataType:'json',
	        data: JSON.stringify(JsonData),
	        success: function (data) {
	           searchResult(data)
	        },
	        error: function (msg) {
	           console.log(msg);
	        }
	    });
      }else {
        var tet = "请输入搜索内容  ！";
        State(tet);
      }

       function searchResult(data) {
       	console.log(data)
        for(var i=0;i < data.data.articlelist.length;i++){
            var essay_main_list = '';
            essay_main_list += '<ul class="main_nav_list essay_nav_list"><li><input type="checkbox"  value='+data.data.articlelist[i].id+' name="list"/><input type="hidden" value='+ data.data.articlelist[i].channellist+' name="channellist"><input type="hidden" value='+ data.data.articlelist[i].summary+' name="summary"><input type="hidden" value='+ data.data.articlelist[i].voiceurl+' name="voiceurl"><img src='+data.data.articlelist[i].picurl+' alt="" /></li><li class="text_info">'+data.data.articlelist[i].title+'</li><li>'+data.data.articlelist[i].source+'</li><li>'+data.data.articlelist[i].create_time+'</li><li class="out_modify">修改</li><li class="text_modify"><a href="publish.html?id='+data.data.articlelist[i].id+'" target="_blank">修改</a></li><li>'+data.data.articlelist[i].publish_time+'</li><li class="issue">发布</li><li class="focused" >置顶</li><p class="show_text">'+data.data.articlelist[i].summary+'</p></ul>';
            $(".search_info").show();
            $(".search_info .main_info").append(essay_main_list);
             /*状态*/
            state(data,i)
        }
          var len = data.data.total;
          console.log(len)
		  pageCon = Math.ceil(len / 20 );
		  clipInit(pageCon);
      }
    }
     /*数据状态*/
    function state(data,i) {
    	/*发布APP状态*/
        var published = data.data.articlelist[i].published;

          switch(published) {
			case '1':
			   $(".issue").eq(i).text("发布成功")
		    break;
		    case '0':
			   $(".issue").eq(i).text("发布");
			   $(".issue").eq(i).addClass("issue_button");
			   $(".focused").eq(i).removeClass("focused_button");
			   $(".focused").eq(i).addClass("nofocused");
		    break;
		  }
        var voiceurl = data.data.articlelist[i].voiceurl;


        /*未生成语音*/
          switch(voiceurl) {
			case null:
			   $(".issue").eq(i).text("发布")
	           $(".issue").eq(i).addClass("noissue");
	           $(".issue").eq(i).removeClass("issue_button");
		    break;
		  }


        /*发布时间*/
        var publish_time = data.data.articlelist[i].publish_time;
          switch(publish_time) {
			case null:
			   $(".publish_time").eq(i).text("———")
		    break;
		  }
        /*置顶*/
        var focused = data.data.articlelist[i].focused;
          switch(focused) {
			case '1':
			   $(".focused").eq(i).text("已置顶")
		    break;
		    case '0':
		       $(".focused").eq(i).text("置顶")
		       $(".focused").eq(i).addClass("focused_button");

		  }
    }

    /*文章分类*/
	  $.ajax({
	    type: 'get',
//	    url: "http://dreamwriter.webdev.com/app/channel",
        url:"http://localhost:3334/1channel",
	    dataType:'json',
	    success: function (data) {
	      sideBar(data)
	    },
	    error: function (msg) {
	      console.log(msg);
	    }
	  });

       var Allmain_list = '';
       var sort_li = '';
       var sort = '';
     function sideBar(data) {

      for(var i = 0; i < data.data.channellist.length; i++) {
      	sort = '<label>\<input type="checkbox"  name="sort" value="'+ data.data.channellist[i].id+'">\<span>'+ data.data.channellist[i].channelname+'</span>\</label>'
        sort_li += '<li>'+ data.data.channellist[i].channelname+'</li>';
        Allmain_list += '<section class="content content_list"><div class="main_info"></div></section>';

        $(".alert_table td").eq(''+data.data.channellist[i].id+''-1).append(sort)
      }
        $(".sort_list").append(sort_li);
        $(".main").append(Allmain_list);
     }

    $.ajax({
	  type: 'get',
	  url: "http://localhost:3334/4article",
//    url: "http://dreamwriter.webdev.com/App/oarticle",
	  dataType:'json',
	  success: function (data) {
	    oarticleData(data)
	  },
	   error: function (msg) {
	        console.log(msg);
	    }
	  });

     function oarticleData(data) {
    	console.log(data.data)
      for(var i=0;i < data.data.articlelist.length ;i++){

            var channelid = data.data.articlelist[i].channellist;

             for(var k=0;k<channelid.length;k++){
             	 var content_list ="";
			     var index = channelid[k];
			     content_list += '<ul class="main_nav_list essay_nav_list"><li><input type="checkbox"  name="list" value='+data.data.articlelist[i].id+' class="son"><input type="hidden" value='+ data.data.articlelist[i].channellist+' name="channellist"><input type="hidden" value='+ data.data.articlelist[i].summary+' name="summary"><input type="hidden" value='+ data.data.articlelist[i].voiceurl+' name="voiceurl"><img src='+data.data.articlelist[i].picurl+' alt="" /></li><li class="text_info">'+data.data.articlelist[i].title+'</li><li>'+data.data.articlelist[i].source+'</li><li>'+data.data.articlelist[i].create_time+'</li><li class="out_modify">修改</li><li class="text_modify"><a href="publish.html?id='+data.data.articlelist[i].id+'" target="_blank">修改</a></li><li class="publish_time">'+data.data.articlelist[i].publish_time+'</li><li class="issue">'+data.data.articlelist[i].published+'</li><li class="focused" >'+data.data.articlelist[i].focused+'</li><p class="show_text">'+ data.data.articlelist[i].summary+'</p></ul>';

                  $(".content_list .main_info").eq(index-1).append(content_list);

             }
        }
    }



    $(document).on('mouseover', '.text_info', function(e) {
      $('.text_info').each(function(index) {
        $(this).hover(function(){
        $(".show_text").eq(index).stop();
        $(".show_text").eq(index).fadeIn(800);
    },function() {
    	$(".show_text").eq(index).stop();
    	$(".show_text").eq(index).fadeOut(500);
      });
     })
    });


    /*概要修改*/

	   $(".main_info").on("mouseover",".out_modify", function() {
          $(".audio").get(0).pause();
          $(".play_eff").hide();
	      $(".playimg").show();
	      $(".alter_mask").hide();
    	  $(".issue_win").hide();

	      var modifys = $(".out_modify");

	      for(var i=0; i<modifys.length; i++){
	         modifys[i].index = i;

	    	 modifys[i].onclick=function() {
			   $(".mask").css({
				 "height": $(document).height(),
				 "width": $(document).width()
			   }).show();
			   $(".alter_info").show();

             /*获取内容*/

              var title = $(this).parent().find('li:eq(1)').text();
              var source = $(this).parent().find('li:eq(2)').text();
              var picurl = $(this).parent().find('img').attr('src');
	    	  var obj_id = $(this).parent().find('input[name=list]').val();
	    	  var old_channelid = $(this).parent().find('input[name=channellist]').val();
	    	  var content = $(this).parent().find('p').text();
              var summary = $(this).parent().find('input[name=summary]').val();
              var voiceurl = $(this).parent().find('input[name=voiceurl]').val();


               if(voiceurl != 'null' && voiceurl != 'undefined') {
				   $(".no_music").hide();
				   $(".music_begin").show();
				   $(".audio").attr("src",voiceurl);
				 }else {
				  $(".music_begin").hide();
				  $(".no_music").show();
				}

            /* 多分类选择*/

	          var channelid= new Array();
				  channelid=old_channelid.split(",");

			    for(var i=0;i<channelid.length;i++){
				  var index = channelid[i];
				  $(".alert_table input").eq(index-1).attr("checked", true);
				}

            /*填充内容*/
	    	  $(".title").val(title);
			  $(".source").val(source);

			  if(summary != 'null' && summary != 'false'){
			  	$(".alert_textarea").val(summary);
			  }

            /*生成语音*/

            $(".gain_voice").bind("click", function() {
            	var summary = $(".alert_textarea").val();

                	var JsonData = {
					  "id": obj_id,
	                  "summary": summary
					}

                if(summary != '') {
	              $.ajax({
				    type: 'post',
//				    url: "http://dreamwriter.webdev.com/app/voice",
				    url: "http://localhost:3334/6voice",
				    dataType:'json',
				    data: JSON.stringify(JsonData),
				    success: function (data) {
				       $(".no_music").hide();
			  	       $(".music_begin").show();
                       $(".music_begin audio").attr("src",data.data.voiceurl);

					    console.log(data.data.voiceurl);
	                    if(data.response.code == 0) {
					      var tet = "语音生成成功！";
			                State(tet);
					    }else {
					      var tet = "语音生成失败！";
			                State(tet);
					    }
				    },
				    error: function (msg) {
		              alert(msg)
				     }
				   });
                } else {
                   var tet = "文章摘要不能为空 ！";
                    State(tet);
                }
            })

             /*保存内容*/

            $(".save_btn").bind("click", function() {
            	var summary = $(this).parent().prev().prev().find("textarea").val();
                var voiceurl = $(this).parent().prev().find("audio").attr('src');
                var title = $(".title").val();
		        var source = $(".source").val();

                saveData(obj_id,title,source,picurl,content,summary,voiceurl)

             });

             /*修改后点击小弹窗保存*/

		    $(".save_win_save").bind("click", function() {
                var summary = $(".alert_textarea").val();
                var voiceurl = $(".audio").attr('src');
                var title = $(".title").val();
		        var source = $(".source").val();

                saveData(obj_id,title,source,picurl,content,summary,voiceurl)

		    })

		    /*修改后点击关闭弹窗*/
		    $(".alert_off").bind("click", function() {
    	         $(".alert_textarea").empty();
    	         $(".audio").get(0).pause();
    	         var newtitle = $(".title").val();
		    	 var newsource = $(".source").val();
		    	 var newsummary = $(".alert_textarea").val();

                 old = old_channelid.split(",");

                  var new_channelid = new Array();
	               $(".alert_table input[name=sort]").each(function() {
	                 if ($(this).is(":checked")) {
	              	   new_channelid.push($(this).val());
	                  }
	              });
	              if (old.sort().toString() == new_channelid.sort().toString() && newtitle == title && newsource == source && newsummary == summary) {
	              	$(".alert_textarea").empty();
			    	$(".mask").hide();
			    	$(".alter_info").hide();
			    	$(".alter_mask").hide();
			    	$(".issue_win").hide();

	              }else{

	              	$(".alter_mask").show();
    	            $(".issue_win").show();
	              }

            })

             /*修改发布内容*/
            $(".issue_btn").bind("click", function() {
//
		         var newtitle = $(".title").val();
		         var newsource = $(".source").val();

		         var summary = $(this).parent().prev().prev().find("textarea").val();
				 var voiceurl = $(this).parent().prev().find("audio").attr('src');

	              var new_channelid = new Array();

	               $(".alert_table input[name=sort]").each(function() {
	                 if ($(this).is(":checked")) {
	              	   new_channelid.push($(this).val());
	                  }
	              });
                SaveData(obj_id,title,channelid,source,picurl,summary,voiceurl,content)
            })

	 	  }
	    }
	 })


        /*直接发布内容*/
        $(document).bind("mouseover",".issue_button",function() {
  	 	  var issues= $(".issue_button")
  	 	   for(var i=0;i<issues.length;i++){
              issues[i].onclick = function() {

	           var title = $(this).parent().find('li:eq(1)').text();
	           var source = $(this).parent().find('li:eq(2)').text();
	           var picurl = $(this).parent().find('img').attr('src');
		       var obj_id = $(this).parent().find('input[name=list]').val();
		       var new_channelid = $(this).parent().find('input[name=channellist]').val();
	           var content = $(this).parent().find('p').text();

               var summary = $(this).parent().prev().prev().find("textarea").val();
			   var voiceurl = $(this).parent().prev().find("audio").attr('src');

				channelid = new_channelid.split(",");

				SaveData(obj_id,title,channelid,source,picurl,summary,voiceurl,content)
                console.log(obj_id,title,channelid,source,picurl,summary,voiceurl,content)
              }
  	 	   }
        })

       /* 发布内容封装*/
         function SaveData(obj_id,title,channelid,source,picurl,summary,voiceurl,content) {
     		var JsonData2 = {
			  	"idlist": [obj_id],
			       "title": title,
		  "channelid_list":channelid,
				  "source": source,
				  "picurl": picurl,
				 "summary": summary,
				"voiceurl": voiceurl,
				 "content": content
			}

		    $.ajax({
		      type: 'post',
//			  url: "http://dreamwriter.webdev.com/app/publish",
			  url: "http://localhost:3334/8publish",
			  dataType:'json',
			  data: JSON.stringify(JsonData2),
			  success: function (data) {
			    if(data.response.code == 0) {
			     var tet = "发布成功  ！";
                    State(tet);
					setInterval(function() {
//                    self.location.reload();
                    },1500);
			    }else {
			     var tet = "发布失败  ！";
                     State(tet);
				  }
			    },
			    error: function (msg) {
			      console.log(msg)
			     }
			});
         }


      /*置顶*/
        $(document).bind("mouseover",".focused_button", function(){
        	  var states= $(".focused_button");
  	 	    for(var i=0;i<states.length;i++){
              states[i].onclick = function() {
               var obj_id = $(this).parent().find('input[name=list]').val();
               console.log(obj_id)
		       $.ajax({
		    	 type: 'get',
//			     url: "http://dreamwriter.webdev.com/app/focus?id="+obj_id,
		         url: "http://localhost:3334/11focus?id="+obj_id,
		         dataType:'json',
		         success: function (data) {
		           console.log(data)

		       	  if(data.response.code == 0) {
					    var tet = "置顶成功  ！";
                        State(tet);

					    setInterval(function() {
		  	               window.location.reload();
		                 },1500);
					}else {
					    var tet = "置顶失败  ！";
                            State(tet);
				  }
		         },
		         error: function (msg) {
		           console.log(msg);
		         }
		        });

              }
             }
        })

       /*保存内容封装*/
       function saveData(obj_id,title,source,picurl,content,summary,voiceurl){

             var newarr = new Array();

              $(".alert_table input[name=sort]").each(function() {
                if ($(this).is(":checked")) {
              	   newarr.push($(this).val());
                 }
              });


          if(title == "") {
            var tet = "内容不能为空  ！";
            State(tet);
            $(".title").next().next().find(".alert_hint").show();
            $(this).focus();
             setInterval(function() {
             	$(".alert_hint").hide();
             },3000)
             return false;
	     }
	     if(source == "") {
            var tet = "内容不能为空  ！";
            State(tet);
            $(".source").next().next().find(".alert_hint").show();
             setInterval(function() {
             	$(".alert_hint").hide();
             },3000)
             return false;
	     }
	     if(summary == "") {
            var tet = "内容不能为空  ！";
            State(tet);
            $(".summary").next().find(".alert_hint").show();
             setInterval(function() {
             	$(".alert_hint").hide();
             },3000)
             return false;
	     }
	     if(content == "") {
	     	var tet = "内容不能为空  ！";
            State(tet);
            $(".content_text").next().find(".alert_hint").show();
             setInterval(function() {
             	$(".alert_hint").hide();
             },3000)
             return false;
	     }
	     if (!$(".alert_table input").is(':checked')) {
            var tet = "请选择分类  ！";
               State(tet);
               $(".table").next().find(".alert_hint").show();
       	 	    setInterval(function() {
             	 $(".alert_hint").hide();
                },3000)
               return false;
       	 }

              var JsonData2 = { 
					  "id": obj_id,
				   "title": title,
		  "channelid_list":newarr,
				  "source": source,
				  "picurl": picurl,
	             "summary": summary,
	            "voiceurl": voiceurl,
	             "content": content
			    }

	      $.ajax({
			    type: 'post',
//			    url: "http://dreamwriter.webdev.com/app/save",
			    url: "http://localhost:3334/7save",
			    dataType:'json',
			    data: JSON.stringify(JsonData2),
			    success: function (data) {
		          if(data.response.code == 0) {
				     var tet = "保存成功  ！";
                         State(tet);
                        setInterval(function() {
                          self.location.reload();
                        },1500);
				  }else {
				     var tet = "保存失败  ！";
                         State(tet);
				  }
			    },
			    error: function (msg) {
	              alert(msg)
			     }
			 });
	    }

    /*关闭弹出小弹窗*/

    $(".issue_off,.call_off").bind("click", function() {
    	$(".alter_mask").hide();
    	$(".issue_win").hide();
    	$(".alert_textarea").empty();
    	$(".audio").get(0).pause();
    })

     /* 修改不保存*/
    $(".save_win_nosave").bind("click", function() {
    	$(".mask").hide();
    	$(".alter_info").hide();
    	$(".audio").get(0).pause();
    })

   /*提示框*/
    function State(tet) {
      $(".state_info").text(tet);
		$(".state_info").fadeIn(500);
		setInterval(function() {
		  $(".state_info").fadeOut();
		},1500);
    }


       /*内容区域切换状态*/
    $(".sort").on('mouseover', ".sort_list li", function() {
      var oLi = $(".sort_list li");
      var oDiv = $(".content");

        for(var i=0;i<oLi.length;i++){
		  oLi[i].index = i;
		  oLi[i].onclick = function(){
		  	 $(".search_info").hide();
			for(var i= 0;i<oLi.length;i++){
				oLi[i].className = '';
				oDiv[i].style.display = 'none';
			}
			  this.className = 'sort_active';
			  oDiv[this.index].style.display = 'block';

              var ind = this.index
			  var len = oDiv.eq(ind).find("ul").length;

              if(ind == 0){
               	pageCon = Math.ceil($(".checkAll").val() / 20 );
	            clipInit(pageCon);
              }else {
               	pageCon = Math.ceil(len / 20 );
	            clipInit(pageCon);
              }


			  $(".checkAll").removeAttr("checked");
              $(".content").eq([this.index]).find("input[name=list]").removeAttr("checked");
			}
		}

     })



 })

 $(".sort").css("height",$(document).height())

</script>
<script src="js/AudioPlay.js"></script>
